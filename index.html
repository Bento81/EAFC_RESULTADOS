<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EAFC Tracker - Meus Resultados</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos CSS */
        :root {
            --primary-color: #007bff; /* Azul vibrante */
            --secondary-color: #28a745; /* Verde do sucesso */
            --accent-color: #6f42c1; /* Roxo para destaque */
            --background-color: #f8f9fa; /* Fundo claro */
            --card-background: #ffffff; /* Fundo dos cartões */
            --text-color: #343a40; /* Texto principal */
            --border-color: #dee2e6; /* Borda leve */
            --hover-color: #0056b3; /* Azul mais escuro no hover */
            --modal-bg: rgba(0, 0, 0, 0.6); /* Fundo escuro do modal */
        }

        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .navbar {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
        }

        .navbar h1 {
            margin: 0;
            font-size: 1.8rem;
        }

        .navbar ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        .navbar ul li {
            margin-left: 2rem;
        }

        .navbar ul li a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .navbar ul li a:hover {
            color: var(--hover-color);
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        section {
            background-color: var(--card-background);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }

        h3 {
            color: var(--secondary-color);
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="date"],
        .form-group select {
            width: calc(100% - 22px); /* Ajuste para padding e borda */
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group button {
            margin-left: 10px;
            padding: 10px 15px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        .form-group button:hover {
            background-color: #218838; /* Tom mais escuro do verde */
        }

        .btn-submit {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 1.5rem;
        }

        .btn-submit:hover {
            background-color: var(--hover-color);
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stat-card h4 {
            margin-top: 0;
            color: var(--accent-color);
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
        }

        .championship-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .championship-card:hover {
            background-color: #e9ecef;
            transform: translateY(-3px);
        }

        .championship-card h4 {
            margin: 0;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .championship-card .view-details-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
        }

        .championship-card .view-details-btn:hover {
            background-color: #218838;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        table th, table td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        table td button {
            background-color: var(--accent-color); /* Roxo para editar */
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background-color 0.3s ease;
            margin-right: 5px; /* Espaço entre botões se houver mais */
        }

        table td button:hover {
            background-color: #5a32a3;
        }

        .btn-back {
            display: block;
            margin-top: 2rem;
            padding: 10px 20px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .btn-back:hover {
            background-color: #5a32a3;
        }

        .hidden-section {
            display: none;
        }

        .hidden {
            display: none !important;
        }

        #no-championships-msg {
            text-align: center;
            font-style: italic;
            color: #6c757d;
        }

        /* Estilos para o Modal */
        .modal {
            display: none; /* Escondido por padrão */
            position: fixed; /* Fixo na tela */
            z-index: 1000; /* Acima de todo o conteúdo */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Habilita scroll se o conteúdo for muito grande */
            background-color: var(--modal-bg); /* Fundo escuro semi-transparente */
            justify-content: center;
            align-items: center;
            padding-top: 50px; /* Para centralizar verticalmente */
        }

        .modal-content {
            background-color: var(--card-background);
            margin: auto;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 20px;
        }

        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        .modal-buttons .save-btn {
            background-color: var(--primary-color);
            color: white;
        }
        .modal-buttons .save-btn:hover {
            background-color: var(--hover-color);
        }

        .modal-buttons .delete-btn {
            background-color: #dc3545; /* Vermelho para deletar */
            color: white;
        }
        .modal-buttons .delete-btn:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    <header class="navbar">
        <h1>EAFC Tracker</h1>
        <nav>
            <ul>
                <li><a href="#" id="home-link">Início</a></li>
                <li><a href="#" id="add-match-link">Adicionar Partida</a></li>
                <li><a href="#" id="championships-link">Meus Campeonatos</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <section id="home-section" class="active-section">
            <h2>Bem-vindo ao seu rastreador de EAFC!</h2>
            <p>Gerencie seus campeonatos e acompanhe seu desempenho.</p>
            <div class="stats-overview">
                <h3>Resumo Geral</h3>
                <div class="stat-card">
                    <h4>Total de Partidas</h4>
                    <p id="total-matches">0</p>
                </div>
                <div class="stat-card">
                    <h4>Total de Vitórias</h4>
                    <p id="total-wins">0</p>
                </div>
                <div class="stat-card">
                    <h4>Total de Gols Marcados</h4>
                    <p id="total-goals-scored">0</p>
                </div>
                 <div class="stat-card">
                    <h4>Total de Gols Sofridos</h4>
                    <p id="total-goals-conceded">0</p>
                </div>
                <div class="stat-card">
                    <h4>Saldo de Gols</h4>
                    <p id="total-goal-difference">0</p>
                </div>
            </div>
        </section>

        <section id="add-match-section" class="hidden-section">
            <h2>Registrar Nova Partida</h2>
            <form id="match-form">
                <div class="form-group">
                    <label for="championship-select">Campeonato:</label>
                    <select id="championship-select"> <option value="">Selecione um campeonato</option>
                    </select>
                    <button type="button" id="new-championship-btn">Novo Campeonato</button>
                </div>

                <div class="form-group hidden" id="new-championship-field">
                    <label for="new-championship-name">Nome do Novo Campeonato:</label>
                    <input type="text" id="new-championship-name" placeholder="Ex: Div Rivals Semana 1, Fut Draft #5">
                </div>

                <div class="form-group">
                    <label for="opponent-name">Nome do Adversário:</label>
                    <input type="text" id="opponent-name" placeholder="Nome do time/jogador" required>
                </div>

                <div class="form-group">
                    <label for="goals-scored">Gols Marcados:</label>
                    <input type="number" id="goals-scored" min="0" required>
                </div>
                <div class="form-group">
                    <label for="goals-conceded">Gols Sofridos:</label>
                    <input type="number" id="goals-conceded" min="0" required>
                </div>
                <div class="form-group">
                    <label for="match-date">Data da Partida:</label>
                    <input type="date" id="match-date" required>
                </div>
                <button type="submit" class="btn-submit">Adicionar Partida</button>
            </form>
        </section>

        <section id="championships-section" class="hidden-section">
            <h2>Meus Campeonatos</h2>
            <div id="championships-list">
                <p id="no-championships-msg">Nenhum campeonato adicionado ainda. Adicione uma partida para criar um!</p>
            </div>
            <div id="championship-details" class="hidden">
                <h3 id="details-championship-name"></h3>
                <div class="stats-overview">
                    <div class="stat-card">
                        <h4>Partidas Jogadas</h4>
                        <p id="details-total-matches">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Vitórias</h4>
                        <p id="details-wins">0</p>
                    </div>
                     <div class="stat-card">
                        <h4>Empates</h4>
                        <p id="details-draws">0</p>
                    </div>
                     <div class="stat-card">
                        <h4>Derrotas</h4>
                        <p id="details-losses">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Gols Marcados</h4>
                        <p id="details-goals-scored">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Gols Sofridos</h4>
                        <p id="details-goals-conceded">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Saldo de Gols</h4>
                        <p id="details-goal-difference">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>Pontos</h4>
                        <p id="details-points">0</p>
                    </div>
                </div>
                <h4>Histórico de Partidas</h4>
                <table id="match-history-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Adversário</th>
                            <th>Placar</th>
                            <th>Resultado</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
                <button class="btn-back" id="back-to-championships-list">Voltar aos Campeonatos</button>
            </div>
        </section>
    </main>

    <div id="editMatchModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Editar Partida</h2>
            <form id="edit-match-form">
                <input type="hidden" id="edit-match-id">
                <input type="hidden" id="edit-championship-id">

                <div class="form-group">
                    <label for="edit-opponent-name">Adversário:</label>
                    <input type="text" id="edit-opponent-name" required>
                </div>
                <div class="form-group">
                    <label for="edit-goals-scored">Gols Marcados:</label>
                    <input type="number" id="edit-goals-scored" min="0" required>
                </div>
                <div class="form-group">
                    <label for="edit-goals-conceded">Gols Sofridos:</label>
                    <input type="number" id="edit-goals-conceded" min="0" required>
                </div>
                <div class="form-group">
                    <label for="edit-match-date">Data da Partida:</label>
                    <input type="date" id="edit-match-date" required>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="save-btn">Salvar Alterações</button>
                    <button type="button" class="delete-btn" id="delete-match-from-modal">Excluir Partida</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // Lógica JavaScript
        document.addEventListener('DOMContentLoaded', () => {
            // Referências aos elementos do DOM
            const homeLink = document.getElementById('home-link');
            const addMatchLink = document.getElementById('add-match-link');
            const championshipsLink = document.getElementById('championships-link');

            const homeSection = document.getElementById('home-section');
            const addMatchSection = document.getElementById('add-match-section');
            const championshipsSection = document.getElementById('championships-section');

            const matchForm = document.getElementById('match-form');
            const championshipSelect = document.getElementById('championship-select');
            const newChampionshipBtn = document.getElementById('new-championship-btn');
            const newChampionshipField = document.getElementById('new-championship-field');
            const newChampionshipNameInput = document.getElementById('new-championship-name');
            const opponentNameInput = document.getElementById('opponent-name');
            const goalsScoredInput = document.getElementById('goals-scored');
            const goalsConcededInput = document.getElementById('goals-conceded');
            const matchDateInput = document.getElementById('match-date');

            const totalMatchesElem = document.getElementById('total-matches');
            const totalWinsElem = document.getElementById('total-wins');
            const totalGoalsScoredElem = document.getElementById('total-goals-scored');
            const totalGoalsConcededElem = document.getElementById('total-goals-conceded');
            const totalGoalDifferenceElem = document.getElementById('total-goal-difference');

            const championshipsListDiv = document.getElementById('championships-list');
            const noChampionshipsMsg = document.getElementById('no-championships-msg');
            const championshipDetailsDiv = document.getElementById('championship-details');
            const detailsChampionshipName = document.getElementById('details-championship-name');
            const detailsTotalMatches = document.getElementById('details-total-matches');
            const detailsWins = document.getElementById('details-wins');
            const detailsDraws = document.getElementById('details-draws');
            const detailsLosses = document.getElementById('details-losses');
            const detailsGoalsScored = document.getElementById('details-goals-scored');
            const detailsGoalsConceded = document.getElementById('details-goals-conceded');
            const detailsGoalDifference = document.getElementById('details-goal-difference');
            const detailsPoints = document.getElementById('details-points');
            const matchHistoryTableBody = document.querySelector('#match-history-table tbody');
            const backToChampionshipsListBtn = document.getElementById('back-to-championships-list');

            // Referências aos elementos do Modal
            const editMatchModal = document.getElementById('editMatchModal');
            const closeButton = editMatchModal.querySelector('.close-button');
            const editMatchForm = document.getElementById('edit-match-form');
            const editMatchIdInput = document.getElementById('edit-match-id');
            const editChampionshipIdInput = document.getElementById('edit-championship-id');
            const editOpponentNameInput = document.getElementById('edit-opponent-name');
            const editGoalsScoredInput = document.getElementById('edit-goals-scored');
            const editGoalsConcededInput = document.getElementById('edit-goals-conceded');
            const editMatchDateInput = document.getElementById('edit-match-date');
            const deleteMatchFromModalBtn = document.getElementById('delete-match-from-modal');

            // Variáveis para armazenar dados (usando localStorage)
            let championships = JSON.parse(localStorage.getItem('eafcChampionships')) || {};
            let currentChampionshipId = null; // Para saber qual campeonato está sendo visualizado

            // --- Funções de Navegação ---
            function showSection(sectionToShow) {
                document.querySelectorAll('main section').forEach(section => {
                    section.classList.add('hidden-section');
                    section.classList.remove('active-section');
                });
                sectionToShow.classList.remove('hidden-section');
                sectionToShow.classList.add('active-section');
            }

            homeLink.addEventListener('click', (e) => {
                e.preventDefault();
                showSection(homeSection);
                updateOverallStats();
            });

            addMatchLink.addEventListener('click', (e) => {
                e.preventDefault();
                showSection(addMatchSection);
                populateChampionshipSelect();
                // Resetar o campo de novo campeonato ao abrir a tela
                newChampionshipField.classList.add('hidden'); // Garante que esteja escondido por padrão
                newChampionshipNameInput.value = '';
                championshipSelect.value = ''; // Limpa a seleção do campeonato
                matchForm.reset(); // Limpa o formulário
            });

            championshipsLink.addEventListener('click', (e) => {
                e.preventDefault();
                showSection(championshipsSection);
                displayChampionshipsList();
                championshipDetailsDiv.classList.add('hidden'); // Esconde detalhes ao voltar para a lista
                championshipsListDiv.classList.remove('hidden'); // Garante que a lista esteja visível
            });

            backToChampionshipsListBtn.addEventListener('click', () => {
                championshipDetailsDiv.classList.add('hidden');
                championshipsListDiv.classList.remove('hidden');
            });

            // --- Funções de Gerenciamento de Campeonatos ---
            function saveChampionships() {
                localStorage.setItem('eafcChampionships', JSON.stringify(championships));
            }

            function populateChampionshipSelect() {
                championshipSelect.innerHTML = '<option value="">Selecione um campeonato</option>';
                for (const id in championships) {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = championships[id].name;
                    championshipSelect.appendChild(option);
                }
            }

            newChampionshipBtn.addEventListener('click', () => {
                // Ao clicar em "Novo Campeonato", sempre mostra o campo e deseleciona o dropdown
                newChampionshipField.classList.remove('hidden');
                championshipSelect.value = ''; // Desseleciona o campeonato existente
                newChampionshipNameInput.focus();
            });

            championshipSelect.addEventListener('change', () => {
                // Se um campeonato existente for selecionado, esconde o campo de novo campeonato
                if (championshipSelect.value !== '') {
                    newChampionshipField.classList.add('hidden');
                    newChampionshipNameInput.value = ''; // Limpa o nome do novo campeonato
                }
            });


            // --- Funções de Adição de Partida ---
            matchForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const opponentName = opponentNameInput.value.trim();
                const goalsScored = parseInt(goalsScoredInput.value);
                const goalsConceded = parseInt(goalsConcededInput.value);
                const matchDate = matchDateInput.value;

                let selectedChampionshipId = championshipSelect.value;
                let championshipName = '';

                // Lógica para determinar se é um campeonato existente ou novo
                const isCreatingNewChampionship = !newChampionshipField.classList.contains('hidden');

                if (isCreatingNewChampionship) {
                    // Criando novo campeonato
                    championshipName = newChampionshipNameInput.value.trim();
                    if (!championshipName) {
                        alert('Por favor, digite o nome do novo campeonato.');
                        return;
                    }
                    // Verifica se o campeonato já existe para evitar duplicatas
                    const existingChamp = Object.values(championships).find(c => c.name.toLowerCase() === championshipName.toLowerCase());
                    if (existingChamp) {
                        selectedChampionshipId = existingChamp.id; // Usa o ID do campeonato existente
                    } else {
                        selectedChampionshipId = `champ_${Date.now()}`; // Novo ID único
                        championships[selectedChampionshipId] = {
                            id: selectedChampionshipId,
                            name: championshipName,
                            matches: []
                        };
                    }
                } else {
                    // Usando campeonato existente
                    if (!selectedChampionshipId) {
                        alert('Por favor, selecione um campeonato existente ou clique em "Novo Campeonato" para criar um.');
                        return;
                    }
                    championshipName = championships[selectedChampionshipId].name;
                }

                const match = {
                    id: `match_${Date.now()}`,
                    opponent: opponentName,
                    goalsScored,
                    goalsConceded,
                    date: matchDate,
                    result: getMatchResult(goalsScored, goalsConceded)
                };

                championships[selectedChampionshipId].matches.push(match);
                saveChampionships();
                matchForm.reset();
                newChampionshipField.classList.add('hidden');
                populateChampionshipSelect();
                updateOverallStats();
                alert('Partida registrada com sucesso!');
            });

            function getMatchResult(gs, gc) {
                if (gs > gc) return 'Vitória';
                if (gs < gc) return 'Derrota';
                return 'Empate';
            }

            // --- Funções de Atualização de Estatísticas ---
            function calculateChampionshipStats(champId) {
                const champ = championships[champId];
                if (!champ || !champ.matches) {
                    return {
                        totalMatches: 0, wins: 0, draws: 0, losses: 0,
                        goalsScored: 0, goalsConceded: 0, goalDifference: 0, points: 0
                    };
                }

                let totalMatches = champ.matches.length;
                let wins = 0;
                let draws = 0;
                let losses = 0;
                let goalsScored = 0;
                let goalsConceded = 0;
                let points = 0;

                champ.matches.forEach(match => {
                    goalsScored += match.goalsScored;
                    goalsConceded += match.goalsConceded;
                    if (match.result === 'Vitória') {
                        wins++;
                        points += 3;
                    } else if (match.result === 'Empate') {
                        draws++;
                        points += 1;
                    } else {
                        losses++;
                    }
                });

                const goalDifference = goalsScored - goalsConceded;

                return {
                    totalMatches, wins, draws, losses,
                    goalsScored, goalsConceded, goalDifference, points
                };
            }

            function updateOverallStats() {
                let totalMatches = 0;
                let totalWins = 0;
                let totalGoalsScored = 0;
                let totalGoalsConceded = 0;

                for (const id in championships) {
                    const stats = calculateChampionshipStats(id);
                    totalMatches += stats.totalMatches;
                    totalWins += stats.wins;
                    totalGoalsScored += stats.goalsScored;
                    totalGoalsConceded += stats.goalsConceded;
                }

                const totalGoalDifference = totalGoalsScored - totalGoalsConceded;

                totalMatchesElem.textContent = totalMatches;
                totalWinsElem.textContent = totalWins;
                totalGoalsScoredElem.textContent = totalGoalsScored;
                totalGoalsConcededElem.textContent = totalGoalsConceded;
                totalGoalDifferenceElem.textContent = totalGoalDifference;
            }

            // --- Funções de Exibição de Campeonatos ---
            function displayChampionshipsList() {
                championshipsListDiv.innerHTML = ''; // Limpa a lista existente
                if (Object.keys(championships).length === 0) {
                    noChampionshipsMsg.classList.remove('hidden');
                } else {
                    noChampionshipsMsg.classList.add('hidden');
                    for (const id in championships) {
                        const champ = championships[id];
                        const champCard = document.createElement('div');
                        champCard.classList.add('championship-card');
                        champCard.innerHTML = `
                            <h4>${champ.name}</h4>
                            <button class="view-details-btn" data-id="${id}">Ver Detalhes</button>
                        `;
                        championshipsListDiv.appendChild(champCard);
                    }
                    // Adicionar event listeners para os botões "Ver Detalhes"
                    document.querySelectorAll('.view-details-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const id = e.target.dataset.id;
                            displayChampionshipDetails(id);
                        });
                    });
                }
            }

            function displayChampionshipDetails(champId) {
                currentChampionshipId = champId; // Armazena o ID do campeonato atual
                const champ = championships[champId];
                if (!champ) return;

                const stats = calculateChampionshipStats(champId);

                detailsChampionshipName.textContent = champ.name;
                detailsTotalMatches.textContent = stats.totalMatches;
                detailsWins.textContent = stats.wins;
                detailsDraws.textContent = stats.draws;
                detailsLosses.textContent = stats.losses;
                detailsGoalsScored.textContent = stats.goalsScored;
                detailsGoalsConceded.textContent = stats.goalsConceded;
                detailsGoalDifference.textContent = stats.goalDifference;
                detailsPoints.textContent = stats.points;

                // Limpar e preencher a tabela de histórico de partidas
                matchHistoryTableBody.innerHTML = '';
                if (champ.matches.length === 0) {
                    const row = matchHistoryTableBody.insertRow();
                    const cell = row.insertCell();
                    cell.colSpan = 5; // Ajustado para 5 colunas (data, adversário, placar, resultado, ações)
                    cell.textContent = 'Nenhuma partida registrada para este campeonato.';
                    cell.style.textAlign = 'center';
                    cell.style.fontStyle = 'italic';
                } else {
                    // Ordenar partidas da mais recente para a mais antiga
                    const sortedMatches = [...champ.matches].sort((a, b) => new Date(b.date) - new Date(a.date));

                    sortedMatches.forEach(match => {
                        const row = matchHistoryTableBody.insertRow();
                        row.innerHTML = `
                            <td>${new Date(match.date).toLocaleDateString('pt-BR')}</td>
                            <td>${match.opponent || 'N/A'}</td>
                            <td>${match.goalsScored} x ${match.goalsConceded}</td>
                            <td>${match.result}</td>
                            <td><button class="edit-match-btn" data-champ-id="${champId}" data-match-id="${match.id}">Editar</button></td>
                        `;
                    });
                }

                // Adicionar event listeners para os botões de editar partida
                matchHistoryTableBody.querySelectorAll('.edit-match-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const champId = e.target.dataset.champId;
                        const matchId = e.target.dataset.matchId;
                        openEditMatchModal(champId, matchId);
                    });
                });

                championshipsListDiv.classList.add('hidden');
                championshipDetailsDiv.classList.remove('hidden');
            }

            // --- Funções do Modal de Edição ---
            closeButton.addEventListener('click', () => {
                editMatchModal.style.display = 'none';
            });

            window.addEventListener('click', (e) => {
                if (e.target === editMatchModal) {
                    editMatchModal.style.display = 'none';
                }
            });

            function openEditMatchModal(champId, matchId) {
                const champ = championships[champId];
                const match = champ.matches.find(m => m.id === matchId);

                if (match) {
                    editMatchIdInput.value = match.id;
                    editChampionshipIdInput.value = champId;
                    editOpponentNameInput.value = match.opponent || '';
                    editGoalsScoredInput.value = match.goalsScored;
                    editGoalsConcededInput.value = match.goalsConceded;
                    editMatchDateInput.value = match.date;
                    editMatchModal.style.display = 'flex'; // Usar flex para centralizar
                }
            }

            editMatchForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const matchId = editMatchIdInput.value;
                const champId = editChampionshipIdInput.value;
                const newOpponentName = editOpponentNameInput.value.trim();
                const newGoalsScored = parseInt(editGoalsScoredInput.value);
                const newGoalsConceded = parseInt(editGoalsConcededInput.value);
                const newMatchDate = editMatchDateInput.value;

                const champ = championships[champId];
                const matchIndex = champ.matches.findIndex(m => m.id === matchId);

                if (matchIndex !== -1) {
                    champ.matches[matchIndex].opponent = newOpponentName;
                    champ.matches[matchIndex].goalsScored = newGoalsScored;
                    champ.matches[matchIndex].goalsConceded = newGoalsConceded;
                    champ.matches[matchIndex].date = newMatchDate;
                    champ.matches[matchIndex].result = getMatchResult(newGoalsScored, newGoalsConceded);

                    saveChampionships();
                    updateOverallStats();
                    displayChampionshipDetails(champId); // Atualiza a tela de detalhes do campeonato
                    editMatchModal.style.display = 'none'; // Fecha o modal
                    alert('Partida atualizada com sucesso!');
                }
            });

            deleteMatchFromModalBtn.addEventListener('click', () => {
                const matchId = editMatchIdInput.value;
                const champId = editChampionshipIdInput.value;
                
                if (confirm('Tem certeza que deseja excluir esta partida?')) {
                    const champ = championships[champId];
                    if (champ) {
                        champ.matches = champ.matches.filter(match => match.id !== matchId);
                        saveChampionships();
                        updateOverallStats();
                        displayChampionshipDetails(champId); // Atualiza os detalhes do campeonato
                        editMatchModal.style.display = 'none'; // Fecha o modal
                        alert('Partida excluída com sucesso!');
                    }
                }
            });

            // --- Inicialização ---
            updateOverallStats(); // Atualiza estatísticas ao carregar a página
            populateChampionshipSelect(); // Popula o select de campeonatos
            showSection(homeSection); // Começa na seção de início
        });
    </script>
</body>
</html>